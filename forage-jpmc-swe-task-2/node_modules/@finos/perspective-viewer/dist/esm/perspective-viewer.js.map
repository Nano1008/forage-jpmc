{
  "version": 3,
  "sources": ["../../src/ts/perspective-viewer.ts", "../../src/ts/plugin.ts", "../../src/ts/extensions.ts", "../../src/ts/migrate.ts", "../../src/ts/init.ts", "../../src/ts/bootstrap.ts"],
  "sourcesContent": ["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\n/**\n * Module for the `<perspective-viewer>` custom element.  This module has no\n * (real) exports, but importing it has a side effect: the\n * `PerspectiveViewerElement`class is registered as a custom element, after\n * which it can be used as a standard DOM element.\n *\n * Though `<perspective-viewer>` is written mostly in Rust, the nature\n * of WebAssembly's compilation makes it a dynamic module;  in order to\n * guarantee that the Custom Elements extension methods are registered\n * synchronously with this package's import, we need perform said registration\n * within this wrapper module.  As a result, the API methods of the Custom\n * Elements are all `async` (as they must await the wasm module instance).\n *\n * The documentation in this module defines the instance structure of a\n * `<perspective-viewer>` DOM object instantiated typically, through HTML or any\n * relevent DOM method e.g. `document.createElement(\"perspective-viewer\")` or\n * `document.getElementsByTagName(\"perspective-viewer\")`.\n *\n * @module perspective-viewer\n */\n\nimport \"mobile-drag-drop-shadow-dom\";\n\nexport {IPerspectiveViewerPlugin} from \"./plugin\";\nexport {HTMLPerspectiveViewerPluginElement} from \"./plugin\";\nexport {IPerspectiveViewerElement} from \"./viewer\";\n\nexport * from \"./extensions\";\nexport * from \"./migrate\";\n\nimport \"./bootstrap\";\n\nexport default {};\n", "/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport type * as perspective from \"@finos/perspective\";\n\n/**\n * The `IPerspectiveViewerPlugin` interface defines the necessary API for a\n * `<perspective-viewer>` plugin, which also must be an `HTMLElement` via the\n * Custom Elements API or otherwise.  Rather than implement this API from\n * scratch however, the simplest way is to inherit from\n * `<perspective-viewer-plugin>`, which implements `IPerspectiveViewerPlugin`\n * with non-offensive default implementations, where only the `draw()` and\n * `name()` methods need be overridden to get started with a simple plugin.\n *\n * Note that plugins are frozen once a `<perspective-viewer>` has been\n * instantiated, so generally new plugin code must be executed at the module\n * level (if packaged as a library), or during application init to ensure global\n * availability of a plugin.\n *\n * @example\n * ```javascript\n * const BasePlugin = customElements.get(\"perspective-viewer-plugin\");\n * class MyPlugin extends BasePlugin {\n *     get name() {\n *         return \"My Plugin\";\n *     }\n *     async draw(view) {\n *         const count = await view.num_rows();\n *         this.innerHTML = `View has ${count} rows`;\n *     }\n * }\n *\n * customElements.define(\"my-plugin\", MyPlugin);\n * const Viewer = customElements.get(\"perspective-viewer\");\n * Viewer.registerPlugin(\"my-plugin\");\n * ```\n * @noInheritDoc\n */\nexport interface IPerspectiveViewerPlugin extends HTMLElement {\n    /**\n     * The name for this plugin, which is used as both it's unique key for use\n     * as a parameter for the `plugin` field of a `ViewerConfig`, and as the\n     * display name for this plugin in the `<perspective-viewer>` UI.\n     */\n    get name(): string;\n\n    /**\n     * Select mode determines how column add/remove buttons behave for this\n     * plugin.  `\"select\"` mode exclusively selects the added column, removing\n     * other columns.  `\"toggle\"` mode toggles the column on or off (dependent\n     * on column state), leaving existing columns alone.\n     */\n    get select_mode(): \"select\" | \"toggle\" | undefined;\n\n    /**\n     * The minimum number of columns required for this plugin to operate.\n     * This mostly affects drag/drop and column remove button behavior,\n     * preventing the use from applying configs which violate this min.\n     *\n     * While this option can technically be `undefined` (as in the case of\n     * `@finos/perspective-viewer-datagrid`), doing so currently has nearly\n     * identical behavior to 1.\n     */\n    get min_config_columns(): number | undefined;\n\n    /**\n     * The named column labels, if desired.  Named columns behave differently\n     * in drag/drop mode than unnamed columns, having replace/swap behavior\n     * rather than insert.  If provided, the length of `config_column_names`\n     * _must_ be `>= min_config_columns`, as this is assumed by the drag/drop\n     * logic.\n     */\n    get config_column_names(): string[] | undefined;\n\n    /**\n     * Render this plugin using the provided `View`.  While there is no\n     * provision to cancel a render in progress per se, calling a method on\n     * a `View` which has been deleted will throw an exception.\n     *\n     * @example\n     * ```\n     * async draw(view: perspective.View): Promise<void> {\n     *     const csv = await view.to_csv();\n     *     this.innerHTML = `<pre>${csv}</pre>`;\n     * }\n     * ```\n     */\n    draw(view: perspective.View): Promise<void>;\n\n    /**\n     * Draw under the assumption that the `ViewConfig` has not changed since\n     * the previous call to `draw()`, but the underlying data has.  Defaults to\n     * dispatch to `draw()`.\n     *\n     * @example\n     * ```javascript\n     * async update(view: perspective.View): Promise<void> {\n     *     return this.draw(view);\n     * }\n     * ```\n     */\n    update(view: perspective.View): Promise<void>;\n\n    /**\n     * Clear this plugin, though it is up to the discretion of the plugin\n     * author to determine what this means.  Defaults to resetting this\n     * element's `innerHTML`, so be sure to override if you want custom\n     * behavior.\n     *\n     * @example\n     * ```javascript\n     * async clear(): Promise<void> {\n     *     this.innerHTML = \"\";\n     * }\n     * ```\n     */\n    clear(): Promise<void>;\n\n    /**\n     * Like `update()`, but for when the dimensions of the plugin have changed\n     * and the underlying data has not.\n     */\n    resize(): Promise<void>;\n\n    /**\n     * Notify the plugin that the style environment has changed.  Useful for\n     * plugins which read CSS styles via `window.getComputedStyle()`.\n     */\n    restyle(): Promise<void>;\n\n    /**\n     * Save this plugin's state to a JSON-serializable value.  While this value\n     * can be anything, it should work reciprocally with `restore()` to return\n     * this plugin's renderer to the same state, though potentially with a\n     * different `View`.\n     *\n     * `save()` should be used for user-persistent settings that are\n     * data-agnostic, so the user can have persistent view during refresh or\n     * reload.  For example, `@finos/perspective-viewer-d3fc` uses\n     * `plugin_config` to remember the user-repositionable legend coordinates.\n     */\n    save(): Promise<any>;\n\n    /**\n     * Restore this plugin to a state previously returned by `save()`.\n     */\n    restore(config: any): Promise<void>;\n\n    /**\n     * Free any resources acquired by this plugin and prepare to be deleted.\n     */\n    delete(): Promise<void>;\n}\n\n/**\n * The `<perspective-viewer-plugin>` element, the default perspective plugin\n * which is registered and activated automcatically when a\n * `<perspective-viewer>` is loaded without plugins.  While you will not\n * typically instantiate this class directly, it is simple enough to function\n * as a good \"default\" plugin implementation which can be extended to create\n * custom plugins.\n *\n * @example\n * ```javascript\n * class MyPlugin extends customElements.get(\"perspective-viewer-plugin\") {\n *    // Custom plugin overrides\n * }\n * ```\n * @noInheritDoc\n */\nexport class HTMLPerspectiveViewerPluginElement\n    extends HTMLElement\n    implements IPerspectiveViewerPlugin\n{\n    constructor() {\n        super();\n    }\n\n    get name(): string {\n        return \"Debug\";\n    }\n\n    get select_mode(): \"select\" | \"toggle\" {\n        return \"select\";\n    }\n\n    get min_config_columns(): number | undefined {\n        return undefined;\n    }\n\n    get config_column_names(): string[] | undefined {\n        return undefined;\n    }\n\n    async update(view: perspective.View): Promise<void> {\n        return this.draw(view);\n    }\n\n    async draw(view: perspective.View): Promise<void> {\n        this.style.backgroundColor = \"#fff\";\n        const csv = await view.to_csv();\n        const css = `margin:0;overflow:scroll;position:absolute;width:100%;height:100%`;\n        this.innerHTML = `<pre style='${css}'>${csv}</pre>`;\n    }\n\n    async clear(): Promise<void> {\n        this.innerHTML = \"\";\n    }\n\n    async resize(): Promise<void> {\n        // Not Implemented\n    }\n\n    async restyle(): Promise<void> {\n        // Not Implemented\n    }\n\n    async save(): Promise<any> {\n        // Not Implemented\n    }\n\n    async restore(): Promise<void> {\n        // Not Implemented\n    }\n\n    async delete(): Promise<void> {\n        // Not Implemented\n    }\n}\n\nif (\n    document.createElement(\"perspective-viewer-plugin\").constructor ===\n    HTMLElement\n) {\n    window.customElements.define(\n        \"perspective-viewer-plugin\",\n        HTMLPerspectiveViewerPluginElement\n    );\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport type * as perspective from \"@finos/perspective\";\nimport type {\n    IPerspectiveViewerElement,\n    PerspectiveViewerConfig,\n} from \"./viewer\";\nimport type {HTMLPerspectiveViewerPluginElement} from \"./plugin\";\n\n// JSX / React extensions\n\ntype ReactPerspectiveViewerAttributes<T> = React.HTMLAttributes<T>;\n\ntype JsxPerspectiveViewerElement = {class?: string} & React.DetailedHTMLProps<\n    ReactPerspectiveViewerAttributes<HTMLPerspectiveViewerElement>,\n    HTMLPerspectiveViewerElement\n>;\n\ndeclare global {\n    // eslint-disable-next-line @typescript-eslint/no-namespace\n    namespace JSX {\n        interface IntrinsicElements {\n            \"perspective-viewer\": JsxPerspectiveViewerElement;\n        }\n    }\n}\n\n// Custom Elements extensions\n\ndeclare global {\n    interface Document {\n        createElement(\n            tagName: \"perspective-viewer\",\n            options?: ElementCreationOptions\n        ): HTMLPerspectiveViewerElement;\n        createElement(\n            tagName: \"perspective-viewer-plugin\",\n            options?: ElementCreationOptions\n        ): HTMLPerspectiveViewerPluginElement;\n    }\n\n    interface CustomElementRegistry {\n        get(tagName: \"perspective-viewer\"): typeof HTMLPerspectiveViewerElement;\n        get(\n            tagName: \"perspective-viewer-plugin\"\n        ): typeof HTMLPerspectiveViewerPluginElement;\n    }\n}\n\nimport {PerspectiveViewerElement} from \"@finos/perspective-viewer/dist/pkg/perspective_viewer.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nclass __PerspectiveViewerElement\n    extends PerspectiveViewerElement\n    implements IPerspectiveViewerElement {}\n\n/**\n * @noInheritDoc\n */\nexport declare class HTMLPerspectiveViewerElement\n    extends HTMLElement\n    implements IPerspectiveViewerElement\n{\n    connectedCallback(): void;\n    load(table: perspective.Table | Promise<perspective.Table>): Promise<void>;\n    notifyResize(force: boolean): Promise<void>;\n    setAutoSize(autosize: boolean): void;\n    getTable(wait_for_table?: boolean): Promise<perspective.Table>;\n    getView(): Promise<perspective.View>;\n    restore(\n        config: string | PerspectiveViewerConfig | ArrayBuffer\n    ): Promise<void>;\n    save(): Promise<PerspectiveViewerConfig>;\n    save(format: \"json\"): Promise<PerspectiveViewerConfig>;\n    save(format: \"arraybuffer\"): Promise<ArrayBuffer>;\n    save(format: \"string\"): Promise<string>;\n    flush(): Promise<void>;\n    reset(all: boolean): Promise<void>;\n    delete(): Promise<void>;\n    download(flat: boolean): Promise<void>;\n    copy(flat: boolean): Promise<void>;\n    restyleElement(): Promise<void>;\n    resetThemes(themes?: string[]): Promise<void>;\n    getEditPort(): number;\n    setThrottle(value?: number): void;\n    toggleConfig(force?: boolean): Promise<void>;\n    getPlugin(name?: string): Promise<HTMLElement>;\n    getAllPlugins(): HTMLElement[];\n    unsafeGetModel(): number;\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\n/**\n * A migration utility for `@finos/perspective-viewer` and\n * `@finos/perspective-workspace` persisted state objects.  If you have an\n * application which persists tokens returned by the `.save()` method of a\n * Perspective Custom Element, and you want to upgrade Perspective to the latest\n * version, this module is for you!  You know who you are!\n *\n * Say you have a `<perspective-viewer>` Custom Element from\n * `@finos/perspective-viewer>=0.8.3`, and have persisted an arbitrary persistence\n * token object:\n *\n * ```javascript\n * const old_elem = document.querySelector(\"perspective-viewer\");\n * const old_token = await old_elem.save();\n * ```\n *\n * To migrate this token to the version of `@finos/perspective-migrate` itself:\n *\n * ```javascript\n * import {convert} from \"@finos/perspective-viewer`;\n *\n * // ...\n *\n * const new_elem = document.querySelector(\"perspective-viewer\");\n * const new_token = convert(old_token);\n * await new_elem.restore(new_token);\n * ```\n *\n * `convert` can also be imported in node for converting persisted tokens\n * outside the browser.\n *\n * ```javascript\n * const {convert} = require(\"@finos/perspective-viewer/dist/cjs/migrate.js\");\n * ```\n * @param old the layout to convert, in `<perspective-viewer>` or\n * `<perspective-workspace>` format.\n * @param options a `PerspectiveConvertOptions` object specifying the convert\n * options for this call.\n * @returns a layout for either `<perspective-viewer>` or\n * `<perspective-workspace>`, updated to the perspective version of this\n * script's package.\n */\nexport function convert(\n    old: Record<string, unknown> | ArrayBuffer | string,\n    {warn = true, replace_defaults = false}: PerspectiveConvertOptions = {}\n): Record<string, unknown> | ArrayBuffer | string {\n    if (typeof old === \"object\" && !(old instanceof ArrayBuffer)) {\n        const copy = JSON.parse(JSON.stringify(old));\n        if (\"viewers\" in copy && \"detail\" in copy) {\n            return migrate_workspace(copy, {warn, replace_defaults});\n        } else {\n            return migrate_viewer(copy, false, {warn, replace_defaults});\n        }\n    } else {\n        return old;\n    }\n}\n\ntype PerspectiveConvertOptions = {\n    warn?: boolean;\n    replace_defaults?: boolean;\n};\n\n/**\n * Migrate a layout for `<perspective-workspace>`\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_workspace(old, options) {\n    for (const key in old.viewers) {\n        old.viewers[key] = migrate_viewer(old.viewers[key], true, options);\n        if (!(\"master\" in old.viewers[key])) {\n            old.viewers[key].master = false;\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective missing attribute \"master\" set to default`\n                );\n            }\n        }\n\n        if (!(\"linked\" in old.viewers[key])) {\n            old.viewers[key].linked = false;\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective missing attribute \"linked\" set to default`\n                );\n            }\n        }\n    }\n\n    return old;\n}\n\n/**\n * Migrate a layout for `<perspective-viewer>`\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_viewer(old, omit_attributes, options) {\n    return chain(\n        old,\n        [\n            migrate_group_by,\n            migrate_split_by,\n            migrate_filters,\n            migrate_expressions,\n            options.replace_defaults ? migrate_nulls : false,\n            migrate_plugins,\n            migrate_plugin_config,\n            omit_attributes\n                ? migrate_attributes_workspace\n                : migrate_attributes_viewer,\n        ].filter((x) => !!x),\n        options\n    );\n}\n\n/**\n * Chains functions of `args` and apply to `old`\n * @param old\n * @param args\n * @param options\n * @returns\n */\nfunction chain(old, args, options) {\n    for (const arg of args) {\n        old = arg(old, options);\n    }\n\n    return old;\n}\n\n/**\n * Replace `null` properties with defaults.  This is not strictly behavioral,\n * as new `<perspective-viewer>` treats `null` as an explicit \"reset to default\"\n * instruction.  However, it may be necessary to ensure that `.save()` returns\n * identical results to `convert()`, which may be desirable when migrating a\n * database of layouts.\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_nulls(old, options) {\n    for (const key of [\"group_by\", \"split_by\", \"filter\", \"sort\"]) {\n        if (old[key] === null) {\n            old[key] = [];\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective missing attribute \"${key}\" set to default\"`\n                );\n            }\n        }\n\n        if (\"aggregates\" in old && old.aggregates === null) {\n            old.aggregates = {};\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective missing attribute \"aggregates\" set to default\"`\n                );\n            }\n        }\n    }\n\n    return old;\n}\n\n/**\n * Helper for alias-replacement migrations\n * @param original\n * @param aliases\n * @returns\n */\nfunction _migrate_field_aliases(original, aliases) {\n    return function (old, options) {\n        let count = 0;\n        for (const pivot of aliases) {\n            if (pivot in old) {\n                if (count++ > 0) {\n                    throw new Error(`Duplicate \"${original}\" fields`);\n                }\n\n                old[original] = old[pivot];\n                if (pivot !== original) {\n                    delete old[pivot];\n                    if (options.warn) {\n                        console.warn(\n                            `Deprecated perspective attribute \"${pivot}\" renamed \"${original}\"`\n                        );\n                    }\n                }\n            }\n        }\n\n        return old;\n    };\n}\n\n/**\n * Migrate `group_by` field aliases\n */\nconst migrate_group_by = _migrate_field_aliases(\"group_by\", [\n    \"group_by\",\n    \"row_pivots\",\n    \"row-pivot\",\n    \"row-pivots\",\n    \"row_pivot\",\n]);\n\n/**\n * Migrate `split_by` field aliases\n */\nconst migrate_split_by = _migrate_field_aliases(\"split_by\", [\n    \"split_by\",\n    \"column_pivots\",\n    \"column-pivot\",\n    \"column-pivots\",\n    \"column_pivot\",\n    \"col_pivots\",\n    \"col-pivot\",\n    \"col-pivots\",\n    \"col_pivot\",\n]);\n\n/**\n * Migrate `filters` field aliases\n */\nconst migrate_filters = _migrate_field_aliases(\"filter\", [\"filter\", \"filters\"]);\n\n/**\n * Migrate the old `computed-columns` format expressions to ExprTK\n * @param regex1\n * @param rep\n * @param expression\n * @param old\n * @param options\n * @returns\n */\nfunction _migrate_expression(regex1, rep, expression, old, options) {\n    if (regex1.test(expression)) {\n        const replaced = expression.replace(regex1, rep);\n        if (options.warn) {\n            console.warn(\n                `Deprecated perspective \"expression\" attribute value \"${expression}\" updated to \"${replaced}\"`\n            );\n        }\n\n        for (const key of [\"group_by\", \"split_by\"]) {\n            if (key in old) {\n                for (const idx in old[key]) {\n                    const pivot = old[key][idx];\n                    if (pivot === expression.replace(/\"/g, \"\")) {\n                        old[key][idx] = replaced;\n                        if (options.warn) {\n                            console.warn(\n                                `Deprecated perspective expression in \"${key}\" attribute \"${expression}\" replaced with \"${replaced}\"`\n                            );\n                        }\n                    }\n                }\n            }\n        }\n\n        for (const filter of old.filter || []) {\n            if (filter[0] === expression.replace(/\"/g, \"\")) {\n                filter[0] = replaced;\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective expression in \"filter\" attribute \"${expression}\" replaced with \"${replaced}\"`\n                    );\n                }\n            }\n        }\n\n        for (const sort of old.sort || []) {\n            if (sort[0] === expression.replace(/\"/g, \"\")) {\n                sort[0] = replaced;\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective expression in \"sort\" attribute \"${expression}\" replaced with \"${replaced}\"`\n                    );\n                }\n            }\n        }\n\n        return replaced;\n    } else {\n        return expression;\n    }\n}\n\n/**\n * Migrate `expressions` field from `computed-columns`\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_expressions(old, options) {\n    if (old[\"computed-columns\"]) {\n        if (\"expressions\" in old) {\n            throw new Error(`Duplicate \"expressions\" and \"computed-columns`);\n        }\n\n        old.expressions = old[\"computed-columns\"];\n        delete old[\"computed-columns\"];\n        if (options.warn) {\n            console.warn(\n                `Deprecated perspective attribute \"computed-columns\" renamed \"expressions\"`\n            );\n        }\n\n        const REPLACEMENTS = [\n            [/^year_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 'y')`],\n            [/^month_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 'M')`],\n            [/^day_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 'd')`],\n            [/^hour_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 'h')`],\n            [/^minute_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 'm')`],\n            [/^second_bucket\\(\"(.+?)\"\\)/, `bucket(\"$1\", 's')`],\n        ];\n\n        for (const idx in old.expressions) {\n            let expression = old.expressions[idx];\n            for (const [a, b] of REPLACEMENTS) {\n                expression = _migrate_expression(\n                    a,\n                    b,\n                    expression,\n                    old,\n                    options\n                );\n            }\n\n            old.expressions[idx] = expression;\n        }\n    }\n\n    return old;\n}\n\n/**\n * Migrate the `plugin` field\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_plugins(old, options) {\n    const ALIASES = {\n        datagrid: \"Datagrid\",\n        Datagrid: \"Datagrid\",\n        d3_y_area: \"Y Area\",\n        \"Y Area\": \"Y Area\",\n        d3_y_line: \"Y Line\",\n        \"Y Line\": \"Y Line\",\n        d3_xy_line: \"X/Y Line\",\n        \"X/Y Line\": \"X/Y Line\",\n        d3_y_scatter: \"Y Scatter\",\n        \"Y Scatter\": \"Y Scatter\",\n        d3_xy_scatter: \"X/Y Scatter\",\n        \"X/Y Scatter\": \"X/Y Scatter\",\n        d3_x_bar: \"X Bar\",\n        \"X Bar\": \"X Bar\",\n        d3_y_bar: \"Y Bar\",\n        \"Y Bar\": \"Y Bar\",\n        d3_heatmap: \"Heatmap\",\n        Heatmap: \"Heatmap\",\n        d3_treemap: \"Treemap\",\n        Treemap: \"Treemap\",\n        d3_sunburst: \"Sunburst\",\n        Sunburst: \"Sunburst\",\n    };\n\n    if (\"plugin\" in old && old.plugin !== ALIASES[old.plugin]) {\n        old.plugin = ALIASES[old.plugin];\n        if (options.warn) {\n            console.warn(\n                `Deprecated perspective \"plugin\" attribute value \"${\n                    old.plugin\n                }\" updated to \"${ALIASES[old.plugin]}\"`\n            );\n        }\n    }\n\n    return old;\n}\n\n/**\n * Migrate the `plugin_config` field\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_plugin_config(old, options) {\n    if (old.plugin === \"Datagrid\" && !!old.plugin_config) {\n        if (!old.plugin_config.columns) {\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective attribute \"plugin_config\" moved to \"plugin_config.columns\"`\n                );\n            }\n\n            const columns = {};\n            for (const name of Object.keys(old.plugin_config)) {\n                const column = old.plugin_config[name];\n                delete old.plugin_config[name];\n\n                if (typeof column.color_mode === \"string\") {\n                    if (column.color_mode === \"foreground\") {\n                        column.number_fg_mode = \"color\";\n                    } else if (column.color_mode === \"bar\") {\n                        column.number_fg_mode = \"bar\";\n                    } else if (column.color_mode === \"background\") {\n                        column.number_bg_mode = \"color\";\n                    } else if (column.color_mode === \"gradient\") {\n                        column.number_bg_mode = \"gradient\";\n                    } else {\n                        console.warn(`Unknown color_mode ${column.color_mode}`);\n                    }\n\n                    // column.number_color_mode = column.color_mode;\n                    delete column[\"color_mode\"];\n\n                    if (options.warn) {\n                        console.warn(\n                            `Deprecated perspective attribute \"color_mode\" renamed \"number_bg_mode\"`\n                        );\n                    }\n                }\n\n                columns[name] = column;\n            }\n\n            old.plugin_config.columns = columns;\n            if (options.replace_defaults) {\n                old.plugin_config.editable = false;\n                old.plugin_config.scroll_lock = true;\n            }\n        }\n\n        // Post 1.5, number columns have been split between `fg` and `bg`\n        // style param contexts.\n        for (const name of Object.keys(old.plugin_config.columns)) {\n            const column = old.plugin_config.columns[name];\n\n            if (typeof column.number_color_mode === \"string\") {\n                if (column.number_color_mode === \"foreground\") {\n                    column.number_fg_mode = \"color\";\n                } else if (column.number_color_mode === \"bar\") {\n                    column.number_fg_mode = \"bar\";\n                } else if (column.number_color_mode === \"background\") {\n                    column.number_bg_mode = \"color\";\n                } else if (column.number_color_mode === \"gradient\") {\n                    column.number_bg_mode = \"gradient\";\n                }\n\n                delete column[\"number_color_mode\"];\n\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective attribute \"number_color_mode\" renamed \"number_bg_mode\"`\n                    );\n                }\n            }\n\n            if (column.gradient !== undefined) {\n                if (column.number_bg_mode === \"gradient\") {\n                    column.bg_gradient = column.gradient;\n                } else if (column.number_fg_mode === \"bar\") {\n                    column.fg_gradient = column.gradient;\n                }\n\n                delete column[\"gradient\"];\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective attribute \"gradient\" renamed \"bg_gradient\"`\n                    );\n                }\n            }\n\n            if (column.pos_color !== undefined) {\n                if (column.number_bg_mode !== undefined) {\n                    column.pos_bg_color = column.pos_color;\n                } else if (column.number_fg_mode !== undefined) {\n                    column.pos_fg_color = column.pos_color;\n                }\n\n                delete column[\"pos_color\"];\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective attribute \"pos_color\" renamed \"pos_bg_color\"`\n                    );\n                }\n            }\n\n            if (column.neg_color !== undefined) {\n                if (column.number_bg_mode !== undefined) {\n                    column.neg_bg_color = column.neg_color;\n                } else if (column.number_fg_mode !== undefined) {\n                    column.neg_fg_color = column.neg_color;\n                }\n\n                delete column[\"neg_color\"];\n                if (options.warn) {\n                    console.warn(\n                        `Deprecated perspective attribute \"neg_color\" renamed \"neg_bg_color\"`\n                    );\n                }\n            }\n        }\n    }\n\n    return old;\n}\n\n/**\n * Migrate attributes which were once persisted but are now considered errors\n * in `<perspective-viewer>` and should only be set in HTML\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_attributes_viewer(old, options) {\n    const ATTRIBUTES = [\n        \"editable\",\n        \"selectable\",\n        \"name\",\n        \"table\",\n        \"master\",\n        \"linked\",\n    ];\n    for (const attr of ATTRIBUTES) {\n        if (attr in old) {\n            delete old[attr];\n\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective attribute \"${attr}\" removed`\n                );\n            }\n        }\n    }\n\n    return old;\n}\n\n/**\n * Migrate attributes which were once persisted but are now considered errors\n * in `<perspective-workspace>` and should only be set in HTML\n * @param old\n * @param options\n * @returns\n */\nfunction migrate_attributes_workspace(old, options) {\n    const ATTRIBUTES = [\n        \"editable\",\n        \"selectable\",\n        \"name\",\n        \"table\",\n        \"master\",\n        \"linked\",\n    ];\n    for (const attr of ATTRIBUTES) {\n        if (attr in old && old[attr] === null) {\n            delete old[attr];\n\n            if (options.warn) {\n                console.warn(\n                    `Deprecated perspective attribute \"${attr}\" removed`\n                );\n            }\n        }\n    }\n\n    return old;\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport {Decompress} from \"fflate\";\nimport init_wasm, * as wasm_module from \"@finos/perspective-viewer/dist/pkg/perspective_viewer.js\";\nimport wasm from \"@finos/perspective-viewer/dist/pkg/perspective_viewer_bg.wasm\";\n\n// There is no way to provide a default rejection handler within a promise and\n// also not lock the await-er, so this module attaches a global handler to\n// filter out cancelled query messages.\nwindow.addEventListener(\"unhandledrejection\", (event) => {\n    if (event.reason?.message === \"View method cancelled\") {\n        event.preventDefault();\n    }\n});\n\nfunction is_gzip(buffer) {\n    return new Uint32Array(buffer.slice(0, 4))[0] == 559903;\n}\n\nasync function load_wasm() {\n    // Perform a silly dance to deal with the different ways webpack and esbuild\n    // load binary\n    const compressed = (await wasm) as unknown;\n\n    let parts: Uint8Array[] = [];\n    let length = 0;\n    const decompressor = new Decompress((chunk) => {\n        if (chunk) {\n            length += chunk.byteLength;\n            parts.push(chunk);\n        }\n    });\n\n    if (compressed instanceof URL || typeof compressed === \"string\") {\n        const resp = await fetch(compressed.toString());\n        const reader = resp.body?.getReader();\n        let state = 0;\n        if (reader !== undefined) {\n            while (true) {\n                const {value, done} = await reader.read();\n                if (done || value === undefined) break;\n                if ((state === 0 && is_gzip(value?.buffer)) || state === 1) {\n                    state = 1;\n                    decompressor.push(value, done);\n                } else {\n                    state = 2;\n                    length += value.byteLength;\n                    parts.push(value);\n                }\n            }\n        }\n    } else if (compressed instanceof Uint8Array) {\n        if (is_gzip(compressed.buffer)) {\n            decompressor.push(compressed, true);\n        } else {\n            length = compressed.byteLength;\n            parts = [compressed];\n        }\n    } else {\n        const array = new Uint8Array(compressed as ArrayBuffer);\n        if (is_gzip(compressed)) {\n            decompressor.push(array, true);\n        } else {\n            length = array.byteLength;\n            parts = [array];\n        }\n    }\n\n    let offset = 0;\n    const buffer = new Uint8Array(length);\n    for (const part of parts) {\n        buffer.set(part, offset);\n        offset += part.byteLength;\n    }\n\n    await init_wasm(buffer);\n    wasm_module.defineWebComponents();\n    return wasm_module;\n}\n\nexport const WASM_MODULE = load_wasm();\n", "/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport {WASM_MODULE} from \"./init\";\nimport {PerspectiveViewerElement} from \"@finos/perspective-viewer/dist/pkg/perspective_viewer.js\";\n\n// This can be done automatically by enabling the `defin_web_components_async`\n// feature, but due to async loading, `<perspective-viewer>` methods will not be\n// available synchronously - this can be mitigated with\n// `customElements.whenDefined()`, but this is a breaking change.\nclass HTMLPerspectiveViewerElement extends HTMLElement {\n    _instance: PerspectiveViewerElement;\n    constructor() {\n        super();\n        this.__load_wasm();\n    }\n\n    async __load_wasm() {\n        await WASM_MODULE;\n        if (this._instance === undefined) {\n            this._instance = new PerspectiveViewerElement(this);\n        }\n    }\n}\n\nconst proto = PerspectiveViewerElement.prototype;\nconst names = Object.getOwnPropertyNames(proto);\nfor (const key of names) {\n    Object.defineProperty(HTMLPerspectiveViewerElement.prototype, key, {\n        value: async function (...args) {\n            await this.__load_wasm();\n            return await this._instance[key].call(this._instance, ...args);\n        },\n    });\n}\n\nfor (const key of [\"registerPlugin\", \"getExprTKCommands\"]) {\n    Object.defineProperty(HTMLPerspectiveViewerElement, key, {\n        value: async function (...args) {\n            const mod = await WASM_MODULE;\n            return mod[key].call(mod, ...args);\n        },\n    });\n}\n\ncustomElements.define(\"perspective-viewer\", HTMLPerspectiveViewerElement);\n"],
  "mappings": "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",
  "names": []
}
