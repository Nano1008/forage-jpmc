import"mobile-drag-drop-shadow-dom";var m=class extends HTMLElement{constructor(){super()}get name(){return"Debug"}get select_mode(){return"select"}get min_config_columns(){}get config_column_names(){}async update(i){return this.draw(i)}async draw(i){this.style.backgroundColor="#fff";let t=await i.to_csv(),r="margin:0;overflow:scroll;position:absolute;width:100%;height:100%";this.innerHTML=`<pre style='${r}'>${t}</pre>`}async clear(){this.innerHTML=""}async resize(){}async restyle(){}async save(){}async restore(){}async delete(){}};document.createElement("perspective-viewer-plugin").constructor===HTMLElement&&window.customElements.define("perspective-viewer-plugin",m);import{PerspectiveViewerElement as j}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";function U(e,{warn:i=!0,replace_defaults:t=!1}={}){if(typeof e=="object"&&!(e instanceof ArrayBuffer)){let r=JSON.parse(JSON.stringify(e));return"viewers"in r&&"detail"in r?w(r,{warn:i,replace_defaults:t}):v(r,!1,{warn:i,replace_defaults:t})}else return e}function w(e,i){for(let t in e.viewers)e.viewers[t]=v(e.viewers[t],!0,i),"master"in e.viewers[t]||(e.viewers[t].master=!1,i.warn&&console.warn('Deprecated perspective missing attribute "master" set to default')),"linked"in e.viewers[t]||(e.viewers[t].linked=!1,i.warn&&console.warn('Deprecated perspective missing attribute "linked" set to default'));return e}function v(e,i,t){return P(e,[E,T,h,k,t.replace_defaults?y:!1,L,A,i?x:D].filter(r=>!!r),t)}function P(e,i,t){for(let r of i)e=r(e,t);return e}function y(e,i){for(let t of["group_by","split_by","filter","sort"])e[t]===null&&(e[t]=[],i.warn&&console.warn(`Deprecated perspective missing attribute "${t}" set to default"`)),"aggregates"in e&&e.aggregates===null&&(e.aggregates={},i.warn&&console.warn('Deprecated perspective missing attribute "aggregates" set to default"'));return e}function f(e,i){return function(t,r){let n=0;for(let s of i)if(s in t){if(n++>0)throw new Error(`Duplicate "${e}" fields`);t[e]=t[s],s!==e&&(delete t[s],r.warn&&console.warn(`Deprecated perspective attribute "${s}" renamed "${e}"`))}return t}}var E=f("group_by",["group_by","row_pivots","row-pivot","row-pivots","row_pivot"]),T=f("split_by",["split_by","column_pivots","column-pivot","column-pivots","column_pivot","col_pivots","col-pivot","col-pivots","col_pivot"]),h=f("filter",["filter","filters"]);function V(e,i,t,r,n){if(e.test(t)){let s=t.replace(e,i);n.warn&&console.warn(`Deprecated perspective "expression" attribute value "${t}" updated to "${s}"`);for(let o of["group_by","split_by"])if(o in r)for(let a in r[o])r[o][a]===t.replace(/"/g,"")&&(r[o][a]=s,n.warn&&console.warn(`Deprecated perspective expression in "${o}" attribute "${t}" replaced with "${s}"`));for(let o of r.filter||[])o[0]===t.replace(/"/g,"")&&(o[0]=s,n.warn&&console.warn(`Deprecated perspective expression in "filter" attribute "${t}" replaced with "${s}"`));for(let o of r.sort||[])o[0]===t.replace(/"/g,"")&&(o[0]=s,n.warn&&console.warn(`Deprecated perspective expression in "sort" attribute "${t}" replaced with "${s}"`));return s}else return t}function k(e,i){if(e["computed-columns"]){if("expressions"in e)throw new Error('Duplicate "expressions" and "computed-columns');e.expressions=e["computed-columns"],delete e["computed-columns"],i.warn&&console.warn('Deprecated perspective attribute "computed-columns" renamed "expressions"');let t=[[/^year_bucket\("(.+?)"\)/,`bucket("$1", 'y')`],[/^month_bucket\("(.+?)"\)/,`bucket("$1", 'M')`],[/^day_bucket\("(.+?)"\)/,`bucket("$1", 'd')`],[/^hour_bucket\("(.+?)"\)/,`bucket("$1", 'h')`],[/^minute_bucket\("(.+?)"\)/,`bucket("$1", 'm')`],[/^second_bucket\("(.+?)"\)/,`bucket("$1", 's')`]];for(let r in e.expressions){let n=e.expressions[r];for(let[s,o]of t)n=V(s,o,n,e,i);e.expressions[r]=n}}return e}function L(e,i){let t={datagrid:"Datagrid",Datagrid:"Datagrid",d3_y_area:"Y Area","Y Area":"Y Area",d3_y_line:"Y Line","Y Line":"Y Line",d3_xy_line:"X/Y Line","X/Y Line":"X/Y Line",d3_y_scatter:"Y Scatter","Y Scatter":"Y Scatter",d3_xy_scatter:"X/Y Scatter","X/Y Scatter":"X/Y Scatter",d3_x_bar:"X Bar","X Bar":"X Bar",d3_y_bar:"Y Bar","Y Bar":"Y Bar",d3_heatmap:"Heatmap",Heatmap:"Heatmap",d3_treemap:"Treemap",Treemap:"Treemap",d3_sunburst:"Sunburst",Sunburst:"Sunburst"};return"plugin"in e&&e.plugin!==t[e.plugin]&&(e.plugin=t[e.plugin],i.warn&&console.warn(`Deprecated perspective "plugin" attribute value "${e.plugin}" updated to "${t[e.plugin]}"`)),e}function A(e,i){if(e.plugin==="Datagrid"&&!!e.plugin_config){if(!e.plugin_config.columns){i.warn&&console.warn('Deprecated perspective attribute "plugin_config" moved to "plugin_config.columns"');let t={};for(let r of Object.keys(e.plugin_config)){let n=e.plugin_config[r];delete e.plugin_config[r],typeof n.color_mode=="string"&&(n.color_mode==="foreground"?n.number_fg_mode="color":n.color_mode==="bar"?n.number_fg_mode="bar":n.color_mode==="background"?n.number_bg_mode="color":n.color_mode==="gradient"?n.number_bg_mode="gradient":console.warn(`Unknown color_mode ${n.color_mode}`),delete n.color_mode,i.warn&&console.warn('Deprecated perspective attribute "color_mode" renamed "number_bg_mode"')),t[r]=n}e.plugin_config.columns=t,i.replace_defaults&&(e.plugin_config.editable=!1,e.plugin_config.scroll_lock=!0)}for(let t of Object.keys(e.plugin_config.columns)){let r=e.plugin_config.columns[t];typeof r.number_color_mode=="string"&&(r.number_color_mode==="foreground"?r.number_fg_mode="color":r.number_color_mode==="bar"?r.number_fg_mode="bar":r.number_color_mode==="background"?r.number_bg_mode="color":r.number_color_mode==="gradient"&&(r.number_bg_mode="gradient"),delete r.number_color_mode,i.warn&&console.warn('Deprecated perspective attribute "number_color_mode" renamed "number_bg_mode"')),r.gradient!==void 0&&(r.number_bg_mode==="gradient"?r.bg_gradient=r.gradient:r.number_fg_mode==="bar"&&(r.fg_gradient=r.gradient),delete r.gradient,i.warn&&console.warn('Deprecated perspective attribute "gradient" renamed "bg_gradient"')),r.pos_color!==void 0&&(r.number_bg_mode!==void 0?r.pos_bg_color=r.pos_color:r.number_fg_mode!==void 0&&(r.pos_fg_color=r.pos_color),delete r.pos_color,i.warn&&console.warn('Deprecated perspective attribute "pos_color" renamed "pos_bg_color"')),r.neg_color!==void 0&&(r.number_bg_mode!==void 0?r.neg_bg_color=r.neg_color:r.number_fg_mode!==void 0&&(r.neg_fg_color=r.neg_color),delete r.neg_color,i.warn&&console.warn('Deprecated perspective attribute "neg_color" renamed "neg_bg_color"'))}}return e}function D(e,i){let t=["editable","selectable","name","table","master","linked"];for(let r of t)r in e&&(delete e[r],i.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}function x(e,i){let t=["editable","selectable","name","table","master","linked"];for(let r of t)r in e&&e[r]===null&&(delete e[r],i.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}import{Decompress as M}from"fflate";import $,*as _ from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";import H from"@finos/perspective-viewer/dist/pkg/perspective_viewer_bg.wasm";window.addEventListener("unhandledrejection",e=>{e.reason?.message==="View method cancelled"&&e.preventDefault()});function u(e){return new Uint32Array(e.slice(0,4))[0]==559903}async function C(){let e=await H,i=[],t=0,r=new M(o=>{o&&(t+=o.byteLength,i.push(o))});if(e instanceof URL||typeof e=="string"){let a=(await fetch(e.toString())).body?.getReader(),c=0;if(a!==void 0)for(;;){let{value:p,done:d}=await a.read();if(d||p===void 0)break;c===0&&u(p?.buffer)||c===1?(c=1,r.push(p,d)):(c=2,t+=p.byteLength,i.push(p))}}else if(e instanceof Uint8Array)u(e.buffer)?r.push(e,!0):(t=e.byteLength,i=[e]);else{let o=new Uint8Array(e);u(e)?r.push(o,!0):(t=o.byteLength,i=[o])}let n=0,s=new Uint8Array(t);for(let o of i)s.set(o,n),n+=o.byteLength;return await $(s),_.defineWebComponents(),_}var g=C();import{PerspectiveViewerElement as b}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";var l=class extends HTMLElement{constructor(){super();this.__load_wasm()}async __load_wasm(){await g,this._instance===void 0&&(this._instance=new b(this))}},S=b.prototype,Y=Object.getOwnPropertyNames(S);for(let e of Y)Object.defineProperty(l.prototype,e,{value:async function(...i){return await this.__load_wasm(),await this._instance[e].call(this._instance,...i)}});for(let e of["registerPlugin","getExprTKCommands"])Object.defineProperty(l,e,{value:async function(...i){let t=await g;return t[e].call(t,...i)}});customElements.define("perspective-viewer",l);var Q={};export{m as HTMLPerspectiveViewerPluginElement,U as convert,Q as default};
//# sourceMappingURL=perspective-viewer.js.map
